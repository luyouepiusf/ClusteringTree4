xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_factor)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
# xx_factor[51:60,1]<-NA
# xx_factor[61:70,2]<-NA
# xx_factor[71:80,3]<-NA
colnames(xx_factor)<-paste0("V",1:ncol(xx_factor))
library(dplyr)
library(grid)
library(gridtext)
library(survival)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05,
missing="weighted")
a_table<-tree_to_table(a_survival_tree$survival_tree)
plot_survival_tree(a_survival_tree)
nind_test<-200
set.seed(-1)
xx_numeric_test<-matrix(rnorm(nind_test*ndim_numeric),nind_test,ndim_numeric)
xx_numeric_test[1:10,1]<-NA
xx_numeric_test[11:20,2]<-NA
xx_numeric_test[21:30,3]<-NA
xx_numeric_test[31:40,4]<-NA
xx_numeric_test[41:50,5]<-NA
colnames(xx_numeric_test)<-paste0("X",1:ncol(xx_numeric_test))
xx_factor_test<-matrix(NA,nind_test,ndim_factor)
xx_factor_test[,1]<-sample(c("AA","BB","CC","DD",NA),nind_test,replace=TRUE)
xx_factor_test[,2]<-sample(c("apple","banana","banana","cherry",NA),nind_test,replace=TRUE)
xx_factor_test[,3]<-sample(c("good","medium","poor",NA),nind_test,replace=TRUE)
colnames(xx_factor_test)<-paste0("V",1:ncol(xx_factor_test))
weight_majority<-predict_weight(a_survival_tree,xx_numeric_test,xx_factor_test,missing="majority")
weight_omit<-predict_weight(a_survival_tree,xx_numeric_test,xx_factor_test,missing="omit")
weight_weighted<-predict_weight(a_survival_tree,xx_numeric_test,xx_factor_test,missing="weighted")
rowSums(weight_majority)
rowSums(weight_omit)
rowSums(weight_weighted)
colnames(weight_majority)
colnames(weight_omit)
colnames(weight_weighted)
library(ClusteringTree4)
result<-predict_distance(a_survival_tree,xx_numeric_test,xx_factor_test)
node_distance
node_distance
node_distance
a_predict_weight
ind_distance<-a_predict_weight%*%node_distance%*%t(a_predict_weight)
ind_distance
node_distance[is.na(node_distance)]<-0
ind_distance<-a_predict_weight%*%node_distance%*%t(a_predict_weight)
ind_distance
missing
a_predict_weight
a_table$terminal
a_predict_weight
a_predict_weight[,a_table$terminal]
a_predict_weight[,!a_table$terminal]
rowSums(a_predict_weight[,!a_table$terminal])
library(ClusteringTree4)
library(ClusteringTree4)
set.seed(5)
nind<-500
ndim_numeric<-5
ndim_factor<-3
ft<-rexp(nind,3)
ct<-rexp(nind,3)
ot<-pmin(ft,ct)
delta<-ft<ct
xx_numeric<-matrix(rnorm(nind*ndim_numeric),nind,ndim_numeric)
xx_numeric[1:10,1]<-NA
xx_numeric[11:20,2]<-NA
xx_numeric[21:30,3]<-NA
xx_numeric[31:40,4]<-NA
xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_factor)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
# xx_factor[51:60,1]<-NA
# xx_factor[61:70,2]<-NA
# xx_factor[71:80,3]<-NA
colnames(xx_factor)<-paste0("V",1:ncol(xx_factor))
library(dplyr)
library(grid)
library(gridtext)
library(survival)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05,
missing="weighted")
a_table<-tree_to_table(a_survival_tree$survival_tree)
plot_survival_tree(a_survival_tree)
nind_test<-200
set.seed(-1)
xx_numeric_test<-matrix(rnorm(nind_test*ndim_numeric),nind_test,ndim_numeric)
xx_numeric_test[1:10,1]<-NA
xx_numeric_test[11:20,2]<-NA
xx_numeric_test[21:30,3]<-NA
xx_numeric_test[31:40,4]<-NA
xx_numeric_test[41:50,5]<-NA
colnames(xx_numeric_test)<-paste0("X",1:ncol(xx_numeric_test))
xx_factor_test<-matrix(NA,nind_test,ndim_factor)
xx_factor_test[,1]<-sample(c("AA","BB","CC","DD",NA),nind_test,replace=TRUE)
xx_factor_test[,2]<-sample(c("apple","banana","banana","cherry",NA),nind_test,replace=TRUE)
xx_factor_test[,3]<-sample(c("good","medium","poor",NA),nind_test,replace=TRUE)
colnames(xx_factor_test)<-paste0("V",1:ncol(xx_factor_test))
weight_majority<-predict_weight(a_survival_tree,xx_numeric_test,xx_factor_test,missing="majority")
weight_omit<-predict_weight(a_survival_tree,xx_numeric_test,xx_factor_test,missing="omit")
weight_weighted<-predict_weight(a_survival_tree,xx_numeric_test,xx_factor_test,missing="weighted")
rowSums(weight_majority)
rowSums(weight_omit)
rowSums(weight_weighted)
predict_distance
args(predict_distance)
result_majority<-predict_distance(a_survival_tree,xx_numeric_test,xx_factor_test,majority)
library(ClusteringTree4)
result_majority<-predict_distance(a_survival_tree,xx_numeric_test,xx_factor_test,"majority")
result_omit<-predict_distance(a_survival_tree,xx_numeric_test,xx_factor_test,"omit")
result_weighted<-predict_distance(a_survival_tree,xx_numeric_test,xx_factor_test,"weighted")
result_majority
image(result_majority$ind_distance)
heatmap(result_majority$ind_distance)
heatmap(result_majority$result_omit)
result_majority$result_omit
heatmap(result_omit$ind_distance)
temp<-result_omit$ind_distance
temp[is.na(temp)]<-1000
heatmap(result_omit$ind_distance)
heatmap(temp)
temp
heatmap(result_weighted$ind_distance)
temp<-result_omit$ind_distance
temp[is.na(temp)]<-100
heatmap(temp)
temp<-result_omit$ind_distance
temp[is.na(temp)]<-20
heatmap(temp)
result_omit$ind_distance
image(temp)
image(result_omit$ind_distance)
diag(temp)
diag(result_omit$ind_distance)
temp
View(result_omit$ind_distance)
library(ClusteringTree4)
a_table
library(ClusteringTree4)
set.seed(5)
nind<-500
ndim_numeric<-5
ndim_factor<-3
ft<-rexp(nind,3)
ct<-rexp(nind,3)
ot<-pmin(ft,ct)
delta<-ft<ct
xx_numeric<-matrix(rnorm(nind*ndim_numeric),nind,ndim_numeric)
xx_numeric[1:10,1]<-NA
xx_numeric[11:20,2]<-NA
xx_numeric[21:30,3]<-NA
xx_numeric[31:40,4]<-NA
xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_factor)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
# xx_factor[51:60,1]<-NA
# xx_factor[61:70,2]<-NA
# xx_factor[71:80,3]<-NA
colnames(xx_factor)<-paste0("V",1:ncol(xx_factor))
library(dplyr)
library(grid)
library(gridtext)
library(survival)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05,
missing="weighted")
a_table<-tree_to_table(a_survival_tree$survival_tree)
a_table
a_table$survival
a_table$survival[[1]]
a_table$survival[[2]]
library(ClusteringTree4)
set.seed(5)
library(ClusteringTree4)
library(ClusteringTree4)
library(survival)
set.seed(0)
nind<-600
x1<-rep(c(-1,1,0),each=nind/3)+rnorm(nind)/2
x2<-rep(c(0,0,sqrt(3)),each=nind/3)+rnorm(nind)/2
x1
x2
ft<-c(rexp(nind/3,1),
rweibull(nind/3,4,2),
rlnorm(nind/3,1,0.2))
ct<-rweibull(nind,4,4)
ot<-pmin(ft,ct)
delta<-ft<ct
layout(rbind(c(1,1,1,2),
c(1,1,1,3),
c(1,1,1,4)))
par(mar=c(0,0,0,0),oma=c(5,5,5,5),cex=0.75)
plot(x1,x2,main="",col=adjustcolor(rep(c("red","purple","orange"),each=nind/3),alpha.f=0.3),pch=16)
xx<-seq(0,5,0.01)
plot(xx,1-pexp(xx,1),type="l",xlab="",ylab="",xaxt="n",yaxt="n",col="red")
plot(xx,1-pweibull(xx,4,2),type="l",xlab="",ylab="",xaxt="n",yaxt="n",col="purple")
plot(xx,1-plnorm(xx,1,0.2),type="l",xlab="",ylab="",xaxt="n",yaxt="n",col="orange")
axis(1)
mtext("x1                 ",side=1,outer=T,line=2.8)
mtext("x2",side=2,outer=T,line=2.8)
xx_numeric<-cbind(x1,x2)
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,0)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05)
library(ClusteringTree4)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05)
plot_survival_tree(a_survival_tree)
predict_node(a_survival_tree,xx_numeric,xx_factor)
tree_to_table(survival_tree$survival_tree)
tree_to_table(a_survival_tree$survival_tree)
tree_to_table(a_survival_tree$survival_tree)
names(a_survival_tree)
library(ClusteringTree4)
plot_survival_tree(a_survival_tree)
library(ClusteringTree4)
library(ClusteringTree4)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05)
plot_survival_tree(a_survival_tree)
library(ClusteringTree4)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05)
plot_survival_tree(a_survival_tree)
plot_survival_tree(a_survival_tree)
library(grid)
plot_survival_tree(a_survival_tree)
library(ClusteringTree4)
library(ClusteringTree4)
a_survival_tree<-survival_tree(
time=ot,
event=delta,
matrix_numeric=xx_numeric,
matrix_factor=xx_factor,
significance=0.05)
plot_survival_tree(a_survival_tree)
predict_node(a_survival_tree,xx_numeric,xx_factor)
predict_weight(a_survival_tree,xx_numeric,xx_factor)
tree_to_table(a_survival_tree$survival_tree)
tree_to_table(a_survival_tree)
set.seed(0)
nind<-800
ndim_numeric<-5
ndim_factor<-3
ft<-rexp(nind,3)
ct<-rexp(nind,3)
ot<-pmin(ft,ct)
delta<-ft<ct
xx_numeric<-matrix(rnorm(nind*ndim_numeric),nind,ndim_numeric)
xx_numeric[1:10,1]<-NA
xx_numeric[11:20,2]<-NA
xx_numeric[21:30,3]<-NA
xx_numeric[31:40,4]<-NA
xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_factor)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
colnames(xx_factor)<-paste0("V",1:ncol(xx_factor))
library(dplyr)
library(grid)
library(gridtext)
library(survival)
set.seed(0)
nboot<-200
all_distance<-array(NA,c(nind,nind,nboot))
for(boot_idx in 1:nboot){
cat(boot_idx)
shuffle<-sample(1:nind,nind,replace=T)
ot_boot<-ot[shuffle]
delta_boot<-delta[shuffle]
xx_numeric_boot<-xx_numeric[shuffle,]
xx_factor_boot<-xx_factor[shuffle,]
a_survival_tree<-survival_tree(
time=ot_boot,
event=delta_boot,
matrix_numeric=xx_numeric_boot,
matrix_factor=xx_factor_boot,
significance=0.05)
cat(" - ")
# plot_survival_tree(a_survival_tree)
# tree_to_table(a_survival_tree$survival_tree)
all_distance[,,boot_idx]<-
predict_distance(a_survival_tree,xx_numeric,xx_factor)$ind_distance
}
forest<-list()
forest[[1]]<-list(abc='p')
forest[[2]]<-list(abc='p')
forest[[3]]<-list(abc='p')
forest
forest[1]
forest<-list()
forest[1]<-list(abc='p')
forest[2]<-list(abc='p')
forest[3]<-list(abc='p')
forest[1]
forest<-list()
forest[1]<-list(abc='p')
forest[2]<-list(abc='p')
forest[3]<-list(abc='p')
forest[1]
forest<-list()
forest[[1]]<-list(abc='p')
forest[[2]]<-list(abc='p')
forest[[3]]<-list(abc='p')
forest[1]
forest[1]$abc
forest[[1]]$abc
forest<-list()
forest[[1]]<-list(abc='p')
forest[[2]]<-list(abc='p')
forest[[3]]<-list(abc='p')
forest[[1]]$abc
object.size(a_survival_tree)
survival_tree
length(forest)
library(survival)
set.seed(0)
nind<-500
ndim_numeric<-5
ndim_factor<-3
ft<-rexp(nind,3)
ct<-rexp(nind,3)
ot<-pmin(ft,ct)
delta<-ft<ct
xx_numeric<-matrix(rnorm(nind*ndim_numeric),nind,ndim_numeric)
xx_numeric[1:10,1]<-NA
xx_numeric[11:20,2]<-NA
xx_numeric[21:30,3]<-NA
xx_numeric[31:40,4]<-NA
xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_factor)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
colnames(xx_factor)<-paste0("V",1:ncol(xx_factor))
library(dplyr)
library(grid)
library(gridtext)
library(survival)
library(survival)
set.seed(0)
nind<-500
x1<-rep(c(-1,1,0),each=nind/3)+rnorm(nind)/2
library(survival)
set.seed(0)
nind<-300
x1<-rep(c(-1,1,0),each=nind/3)+rnorm(nind)/2
x2<-rep(c(0,0,sqrt(3)),each=nind/3)+rnorm(nind)/2
ft<-c(rexp(nind/3,1),
rweibull(nind/3,4,2),
rlnorm(nind/3,1,0.2))
ct<-rweibull(nind,4,4)
set.seed(0)
nind<-500
ndim_numeric<-5
ndim_factor<-3
ft<-rexp(nind,3)
ct<-rexp(nind,3)
ot<-pmin(ft,ct)
delta<-ft<ct
xx_numeric<-matrix(rnorm(nind*ndim_numeric),nind,ndim_numeric)
xx_numeric[1:10,1]<-NA
xx_numeric[11:20,2]<-NA
xx_numeric[21:30,3]<-NA
xx_numeric[31:40,4]<-NA
xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_factor)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
set.seed(0)
nind<-500
ndim_num<-5
ndim_fac<-3
ft<-rexp(nind,3)
ct<-rexp(nind,3)
ot<-pmin(ft,ct)
delta<-ft<ct
xx_numeric<-matrix(rnorm(nind*ndim_num),nind,ndim_num)
xx_numeric[1:10,1]<-NA
xx_numeric[11:20,2]<-NA
xx_numeric[21:30,3]<-NA
xx_numeric[31:40,4]<-NA
xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_fac)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
colnames(xx_factor)<-paste0("V",1:ncol(xx_factor))
library(dplyr)
library(grid)
library(gridtext)
library(survival)
set.seed(0)
args(survival_forest)
a_survival_forest<-survival_forest(
ot,delta,rep(1,nind),xx_numeric,xx_factor,
significance=0.05)
library(dplyr)
library(grid)
library(gridtext)
library(survival)
a_survival_forest<-survival_forest(
ot,delta,rep(1,nind),xx_numeric,xx_factor,
significance=0.05)
library(ClusteringTree4)
set.seed(0)
nind<-400
ndim_num<-5
ndim_fac<-3
ft<-rexp(nind,3)
ct<-rexp(nind,3)
ot<-pmin(ft,ct)
delta<-ft<ct
xx_numeric<-matrix(rnorm(nind*ndim_num),nind,ndim_num)
xx_numeric[1:10,1]<-NA
xx_numeric[11:20,2]<-NA
xx_numeric[21:30,3]<-NA
xx_numeric[31:40,4]<-NA
xx_numeric[41:50,5]<-NA
colnames(xx_numeric)<-paste0("X",1:ncol(xx_numeric))
xx_factor<-matrix(NA,nind,ndim_fac)
xx_factor[,1]<-sample(c("AA","BB","CC","DD",NA),nind,replace=TRUE)
xx_factor[,2]<-sample(c("apple","banana","banana","cherry",NA),nind,replace=TRUE)
xx_factor[,3]<-sample(c("good","medium","poor",NA),nind,replace=TRUE)
colnames(xx_factor)<-paste0("V",1:ncol(xx_factor))
library(dplyr)
library(grid)
library(gridtext)
library(survival)
a_survival_forest<-survival_forest(
ot,delta,rep(1,nind),xx_numeric,xx_factor,
significance=0.05)
a_result<-predict_distance_forest(
a_survival_forest,
xx_numeric,
xx_factor)
a_result<-predict_distance_forest(
a_survival_forest,
xx_numeric,
xx_factor)
a_survival_tree[[boot_idx]]
predict_weight(a_survival_tree,xx_numeric,xx_factor)
a_result<-predict_distance_forest(
a_survival_forest,
xx_numeric,
xx_factor)
a_result<-predict_distance_forest(
a_survival_forest,
xx_numeric,
xx_factor)
length(a_survival_forest)
a_survival_forest
library(ClusteringTree4)
a_survival_forest<-survival_forest(
ot,delta,rep(1,nind),xx_numeric,xx_factor,
significance=0.05,nboot=50)
length(a_survival_forest)
a_result<-predict_distance_forest(
a_survival_forest,
xx_numeric,
xx_factor)
a_result
a_result$mean_distance
image(a_result$mean_distance)
